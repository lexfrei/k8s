apiVersion: operator.victoriametrics.com/v1beta1
kind: VMRule
metadata:
  name: external-secrets
  namespace: monitoring
spec:
  groups:
    - name: external-secrets
      rules:
        - alert: ClusterSecretStoreUnhealthy
          expr: clustersecretstore_status_condition{condition="Ready",status="False"} == 1
          for: 10m
          labels:
            severity: critical
          annotations:
            summary: "ClusterSecretStore {{ $labels.name }} is not ready"
            description: >-
              ClusterSecretStore {{ $labels.name }} has been unhealthy
              for more than 10 minutes. All ExternalSecrets depending on
              this store will fail to sync.
        - alert: ExternalSecretSyncFailed
          expr: externalsecret_status_condition{condition="Ready",status="False"} == 1
          for: 30m
          labels:
            severity: warning
          annotations:
            summary: "ExternalSecret {{ $labels.namespace }}/{{ $labels.name }} sync failed"
            description: >-
              ExternalSecret {{ $labels.namespace }}/{{ $labels.name }}
              has not synced successfully for more than 30 minutes.
