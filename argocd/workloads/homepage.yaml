apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: homepage
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: workloads
  destination:
    namespace: homepage
    server: "https://kubernetes.default.svc"
  sources:
    - repoURL: "https://jameswynn.github.io/helm-charts"
      targetRevision: "2.1.0"
      chart: homepage
      helm:
        valuesObject:
          image:
            tag: v1.10.1
          enableRbac: true
          serviceAccount:
            create: true
            name: homepage
          extraClusterRoles:
            - apiGroups:
                - gateway.networking.k8s.io
              resources:
                - httproutes
                - gateways
              verbs:
                - get
                - list
            - apiGroups:
                - metrics.k8s.io
              resources:
                - nodes
                - pods
              verbs:
                - get
                - list
          env:
            - name: HOMEPAGE_ALLOWED_HOSTS
              value: "start.lex.la"
          envFrom:
            - secretRef:
                name: homepage-secrets
          config:
            settings:
              title: Home Lab
              theme: dark
              color: slate
              headerStyle: clean
              layout:
                Infrastructure:
                  style: row
                  columns: 5
                Monitoring:
                  style: row
                  columns: 1
                Security:
                  style: row
                  columns: 2
                Workloads:
                  style: row
                  columns: 4
            services:
              - Infrastructure:
                  - ArgoCD:
                      icon: argo-cd.svg
                      href: https://argocd.home.lex.la
                      description: GitOps continuous delivery
                      widget:
                        type: argocd
                        url: http://argocd-server.argocd.svc
                        key: "{{HOMEPAGE_VAR_ARGOCD_KEY}}"
                  - Longhorn:
                      icon: longhorn.svg
                      href: https://longhorn.home.lex.la
                      description: Distributed block storage
                      siteMonitor: https://longhorn.home.lex.la
                  - TrueNAS:
                      icon: truenas.svg
                      href: https://truenas.home.lex.la
                      description: Network storage
                      widget:
                        type: truenas
                        url: https://172.16.10.19
                        key: "{{HOMEPAGE_VAR_TRUENAS_KEY}}"
                        enablePools: true
                  - Router:
                      icon: router.svg
                      href: http://172.16.0.1
                      description: Network router
                      widget:
                        type: unifi
                        url: https://172.16.0.1
                        key: "{{HOMEPAGE_VAR_UNIFI_KEY}}"
                  - Hubble:
                      icon: cilium.svg
                      href: https://hubble.home.lex.la
                      description: Network observability
                      siteMonitor: https://hubble.home.lex.la
              - Monitoring:
                  - Grafana:
                      icon: grafana.svg
                      href: https://grafana.home.lex.la
                      description: Metrics visualization
                      siteMonitor: https://grafana.home.lex.la
              - Security:
                  - Authelia:
                      icon: authelia.svg
                      href: https://authelia.lex.la
                      description: SSO and 2FA
                      siteMonitor: https://authelia.lex.la
                  - OpenBao:
                      icon: vault.svg
                      href: https://openbao.home.lex.la
                      description: Secrets management
                      siteMonitor: https://openbao.home.lex.la
              - Workloads:
                  - Transmission:
                      icon: transmission.svg
                      href: https://transmission.home.lex.la
                      description: BitTorrent client
                      siteMonitor: https://transmission.home.lex.la
                      widget:
                        type: transmission
                        url: http://transmission.transmission-system.svc:9091
                  - Minecraft Map:
                      icon: minecraft.svg
                      href: https://map.lex.la
                      description: BlueMap world viewer
                      widget:
                        type: gamedig
                        serverType: minecraft
                        url: udp://172.16.100.253:25565
            widgets:
              - kubernetes:
                  cluster:
                    show: true
                    cpu: true
                    memory: true
                    showLabel: true
                    label: "homelab"
                  nodes:
                    show: true
                    cpu: true
                    memory: true
                    showLabel: true
              - datetime:
                  text_size: xl
                  format:
                    dateStyle: long
                    timeStyle: short
                    hour12: false
            kubernetes:
              mode: cluster
            bookmarks: []
            docker: []
          resources:
            requests:
              cpu: 10m
              memory: 64Mi
            limits:
              cpu: 500m
              memory: 256Mi
    - repoURL: https://github.com/lexfrei/k8s.git
      targetRevision: HEAD
      path: manifests/homepage
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
