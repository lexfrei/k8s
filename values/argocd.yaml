global:
  domain: argocd.home.lex.la
  affinity:
    podAntiAffinity: soft
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: ScheduleAnyway
configs:
  params:
    server.insecure: true
    controller.status.processors: "10"
    controller.operation.processors: "5"
    controller.kubectl.parallelism.limit: "5"
    controller.repo.server.timeout.seconds: "90"
    controller.self.heal.backoff.timeout.seconds: "5"
    controller.self.heal.backoff.cap.seconds: "600"
    controller.cluster.cache.events.processing.interval: "200ms"
    controller.k8s.client.qps: "20"
    controller.k8s.client.burst: "40"
    reposerver.parallelism.limit: "2"
  cm:
    # Disable local admin login - OIDC only
    admin.enabled: "false"
    accounts.homepage: apiKey
    url: https://argocd.home.lex.la
    timeout.reconciliation: 300s
    timeout.hard.reconciliation: 0s
    resource.ignoreResourceUpdatesEnabled: "true"
    # Using Dex for OIDC - Authelia includes all claims in ID token via claims_policy
    dex.config: |
      connectors:
        - type: oidc
          id: authelia
          name: Authelia
          config:
            issuer: https://authelia.lex.la
            clientID: argocd
            clientSecret: $dex.authelia.clientSecret
            scopes:
              - openid
              - profile
              - email
              - groups
            userNameKey: preferred_username
            # Allow Dex to read and propagate groups claim from ID token
            # "insecure" refers to groups not updating on token refresh, not a security issue
            insecureEnableGroups: true
            insecureSkipEmailVerified: true
    application.resourceTrackingMethod: annotation
  rbac:
    policy.csv: |
      g, admins, role:admin
      p, homepage, applications, get, */*, allow
  secret:
    extra:
      dex.authelia.clientSecret: c6d255b2b92e2fec47c1b56dea8ab2bff77a7a7c7f46ef3c99859779c7932afd
    resource.compareoptions: |
      ignoreAggregatedRoles: true
    resource.exclusions: |
      - apiGroups:
        - "*"
        kinds:
        - ProviderConfigUsage
    resource.customizations: ""
controller:
  resources:
    requests:
      cpu: 100m
      memory: 512Mi
    limits:
      memory: 768Mi
  env:
    - name: GOMEMLIMIT
      value: "600MiB"
repoServer:
  replicas: 1
  pdb:
    enabled: false
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      memory: 256Mi
  env:
    - name: GOMEMLIMIT
      value: "200MiB"
server:
  replicas: 1
  pdb:
    enabled: false
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      memory: 128Mi
  service:
    type: LoadBalancer
    annotations:
      io.cilium/lb-ipam-ips: "172.16.100.254"
      external-dns.alpha.kubernetes.io/hostname: "api.argocd.home.lex.la"
  ingress:
    enabled: false
  httproute:
    enabled: true
    annotations: {}
    parentRefs:
      - name: cilium-gateway-internal
        namespace: kube-system
        sectionName: https-home-lex-la
    hostnames:
      - argocd.home.lex.la
    rules:
      - matches:
          - path:
              type: PathPrefix
              value: /
redis:
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      memory: 64Mi
dex:
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      memory: 64Mi
notifications:
  enabled: false
applicationSet:
  replicas: 0
