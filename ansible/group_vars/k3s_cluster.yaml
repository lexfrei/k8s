---
# K3s cluster configuration variables
# Applied to all nodes in k3s_cluster group

# Ansible connection settings
ansible_user: ansible
ansible_python_interpreter: /usr/bin/python3
ansible_ssh_common_args: "-o StrictHostKeyChecking=no"

# K3s version is now defined in inventory/production.yaml vars section
# to ensure proper inheritance by server and agent groups

# Cluster token (retrieved from existing cluster)
# Get from: sudo cat /var/lib/rancher/k3s/server/token
# Or encrypt with: ansible-vault encrypt_string 'TOKEN_VALUE' --name 'token'
token: "K10142c98439253958f48327589a1ea4b32e04f44d619bd47d2ba9593b4acd12d14::server:715647ac6872b2ebe0c3198651b6dcdb"

# API endpoint (first control plane node, used for k3s join)
api_endpoint: "172.16.101.1"
api_port: 6443

# Custom K3s server arguments
# These flags match the existing cluster configuration
extra_server_args: >-
  --disable=traefik
  --disable=local-storage
  --disable=servicelb
  --disable=metrics-server
  --disable=coredns
  --cluster-domain=k8s.home.lex.la
  --disable-network-policy
  --disable-kube-proxy
  --flannel-backend=none
  --tls-san=172.16.101.1
  --etcd-arg=quota-backend-bytes=536870912
  --etcd-arg=auto-compaction-mode=periodic
  --etcd-arg=auto-compaction-retention=1h
  --etcd-arg=snapshot-count=10000
  --etcd-snapshot-retention=3
  --etcd-snapshot-schedule-cron="0 */6 * * *"

# Cluster context name for kubeconfig
cluster_context: k3s-home

# Copy kubeconfig to control node
user_kubectl: true
kubeconfig: "~/.kube/config"

# K3s installation paths
k3s_server_location: "/var/lib/rancher/k3s"
systemd_dir: "/etc/systemd/system"
# Cluster configuration
# Note: --cluster-init is automatically added for HA when server count > 1
# Note: extractedprism handles per-node API LB (127.0.0.1:7445), VIP no longer used at runtime

# Important: Cilium CNI is deployed via ArgoCD, not during K3s installation
# flannel-backend=none disables default Flannel CNI
