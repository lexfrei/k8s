---
# K3s cluster upgrade playbook
# Wrapper for k3s.orchestration.k3s_upgrade role with custom configuration
#
# Usage: ansible-playbook playbooks/k3s-upgrade.yaml
#
# This playbook:
# 1. Upgrades K3s version on all nodes
# 2. Preserves custom configuration (Cilium, vipalived, etc.)
# 3. Upgrades servers sequentially (prevents etcd quorum loss)
# 4. Upgrades agents in parallel
#
# IMPORTANT: Update k3s_version in inventory/production.yaml (k3s_cluster vars) before running

# Servers should be restarted sequentially to avoid etcd learner issues
- name: Upgrade K3s Servers
  hosts: server
  become: true
  serial: 1
  roles:
    - role: k3s.orchestration.k3s_upgrade

# Agents have no such limitation and can be upgraded in parallel
- name: Upgrade K3s Agents
  hosts: agent
  become: true
  roles:
    - role: k3s.orchestration.k3s_upgrade
